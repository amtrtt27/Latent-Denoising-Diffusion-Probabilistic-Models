11/17/2024 06:05:06 - INFO - __main__ - ***** Training arguments *****
11/17/2024 06:05:06 - INFO - __main__ - Namespace(config='configs/ddpm.yaml', test_imple=False, data_dir='./data/imagenet100_128x128', image_size=128, batch_size=30, num_workers=4, num_classes=None, run_name='exp-25-ddpm', output_dir='experiments', num_epochs=10, learning_rate=0.001, weight_decay=0.0001, grad_clip=1.0, seed=42, mixed_precision='none', num_train_timesteps=1000, num_inference_steps=50, beta_start=0.0001, beta_end=0.02, beta_schedule='linear', variance_type='fixed_small', prediction_type='epsilon', clip_sample=True, clip_sample_range=1.0, unet_in_size=128, unet_in_ch=3, unet_ch=128, unet_ch_mult=[1, 2, 2, 4], unet_attn=[2, 3], unet_num_res_blocks=2, unet_dropout=0.0, latent_ddpm=False, use_cfg=False, cfg_guidance_scale=None, use_ddim=False, ckpt=None, predictor_type='epsilon', distributed=False, world_size=1, rank=0, local_rank=0, device='cuda', total_batch_size=30, max_train_steps=43340)
11/17/2024 06:05:06 - INFO - __main__ - ***** Running training *****
11/17/2024 06:05:06 - INFO - __main__ -   Num examples = 130000
11/17/2024 06:05:06 - INFO - __main__ -   Num Epochs = 10
11/17/2024 06:05:06 - INFO - __main__ -   Instantaneous batch size per device = 30
11/17/2024 06:05:06 - INFO - __main__ -   Total train batch size (w. parallel, distributed & accumulation) = 30
11/17/2024 06:05:06 - INFO - __main__ -   Total optimization steps per epoch 4334
11/17/2024 06:05:06 - INFO - __main__ -   Total optimization steps = 43340
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 06:05:06 - INFO - __main__ - Epoch 1/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0105 (0.0308)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.86it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_0.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 07:01:52 - INFO - __main__ - Epoch 2/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0417 (0.0209)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_1.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 07:58:39 - INFO - __main__ - Epoch 3/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0087 (0.0205)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_2.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 08:55:25 - INFO - __main__ - Epoch 4/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0568 (0.0206)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_3.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 09:52:11 - INFO - __main__ - Epoch 5/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0080 (0.0203)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_4.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 10:48:57 - INFO - __main__ - Epoch 6/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0333 (0.0204)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_5.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 11:45:44 - INFO - __main__ - Epoch 7/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0253 (0.0205)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_6.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 12:42:30 - INFO - __main__ - Epoch 8/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0189 (0.0203)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_7.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 13:39:16 - INFO - __main__ - Epoch 9/10
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4334/4334 [56:38<00:00,  1.28it/s, loss=0.0237 (0.0206)]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:06<00:00,  7.96it/s]
Checkpoint saved at experiments/exp-25-ddpm/checkpoints/checkpoint_epoch_8.pth
  0%|                                                                                                                                                                                 | 0/4334 [00:00<?, ?it/s]11/17/2024 14:36:03 - INFO - __main__ - Epoch 10/10
 73%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                       | 3156/4334 [41:16<15:24,  1.27it/s, loss=0.0184 (0.0204)]Traceback (most recent call last):
  File "/home/ubuntu/idl/Latent-Denoising-Diffusion-Probabilistic-Models/train.py", line 414, in <module>
    main()
  File "/home/ubuntu/idl/Latent-Denoising-Diffusion-Probabilistic-Models/train.py", line 351, in main
    scaler.scale(loss).backward() # This is a replacement for loss.backward()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/lib/python3.12/site-packages/torch/_tensor.py", line 581, in backward
    torch.autograd.backward(
  File "/opt/conda/lib/python3.12/site-packages/torch/autograd/__init__.py", line 347, in backward
    _engine_run_backward(
  File "/opt/conda/lib/python3.12/site-packages/torch/autograd/graph.py", line 825, in _engine_run_backward
    return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
